<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
  <title>책정보 보기</title>
  <script type="text/javascript" src="ajax.js"></script>
  <script type="text/javascript">
  var xmlDoc = null;
  var xslDoc = null;

  function loadBooks() {
	new  ajax.xhr.Request("books.jsp", null, loadBooksXML, "GET");
    new  ajax.xhr.Request("books.xsl", null, loadBooksXSL, "GET");
  }
    
  function loadBooksXML(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        xmlDoc = reg.responseXML;
        doXSLT();
      }
    }
  }
  
  function loadBooksXSL(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        xslDoc = reg.responseXML;
        doXSLT();
      }
    }
  }
	
  function doXSLT() {
    if (xmlDoc == null || xslDoc == null) return;
    
    var msg_id = document.getElementById("xmlList");
    
    if (window.ActiveXObject) {
      msg_id.innerHTML = xmlDoc.transformNode(xslDoc);
    } else {
      var xsltProc = new XSLTProcessor();
      xsltProc.importStylesheet(xslDoc);
      var fragment = xsltProc.transformToFragment(xmlDoc, document);
      msg_id.innerHTML = "";
      msg_id.appendChild(fragment);
    }
  } 


  function setNodeValue(node, value) {
    if (node == null) return ;
    
    var childList = node.childNodes;
    for (var i=0;i<childList.length;i++) {
      //node의 value을 변견한다.
      if (childList[i].nodeType == 3) {
        childList[i].nodeValue = value;
        return;
      }
    }
  }

  function testCase1() {
    //root 요소를 얻는다.
    var root = xmlDoc.documentElement;
    var tick = (new Date()).getTime();
  
    for (var i=0;i<1000;i++) {
      //book 요소를 생성한다.
      var book = xmlDoc.createElement("book");
      //isbn 요소를 생성한다.
      var isbn = xmlDoc.createElement("isbn");
      //title 요소를 생성한다.
      var title = xmlDoc.createElement("title");
      //author 요소를 생성한다.
      var author = xmlDoc.createElement("author");
      
      //book 요소의 하위에 isbn 요소를 삽입한다.
      book.appendChild(isbn);
      //book 요소의 하위에 title 요소를 삽입한다.
      book.appendChild(title);
      //book 요소의 하위에 author 요소를 삽입한다.
      book.appendChild(author);
  
      //isbn 요소의 하위에 문자열노드를 생성한 후 추가한다.
      isbn.appendChild(xmlDoc.createTextNode("12-1234-123-5"));
      //title 요소의 하위에 문자열노드를 생성한 후 추가한다.
      title.appendChild(xmlDoc.createTextNode("타짜"));
      //author 요소의 하위에 문자열노드를 생성한 후 추가한다.
      author.appendChild(xmlDoc.createTextNode("허영만"));
      
      //루트 노드에 book 노드를 삽입한다 .
      root.appendChild(book);
    }
    
    tick = (new Date()).getTime() - tick;
    
    document.getElementById("id1").innerHTML = tick;
    
    //화면에 출력한다 .
//    doXSLT();
  }  

  function testCase2() {
    //root 요소를 얻는다.
    var root = xmlDoc.documentElement;
    var book = root.childNodes[0];
    var newBook;
    var tick = (new Date()).getTime();
  
    if (window.ActiveXObject) {
      for (var i=0;i<1000;i++) {
        newBook = book.cloneNode(true);
        //하위 요소 문자열을 변경한다.
        setNodeValue(newBook.childNodes[0], "12-1234-123-9");
        setNodeValue(newBook.childNodes[1], "새로운 책");
        setNodeValue(newBook.childNodes[2], "저자");
        root.appendChild(newBook);
      }
    } else {
      for (var i=0;i<1000;i++) {
        newBook = book.cloneNode(true);
        //하위 요소 문자열을 변경한다.
        setNodeValue(newBook.childNodes[1], "12-1234-123-9");
        setNodeValue(newBook.childNodes[3], "새로운 책");
        setNodeValue(newBook.childNodes[5], "저자");
        root.appendChild(newBook);
      }
    }
        
    tick = (new Date()).getTime() - tick;
    document.getElementById("id2").innerHTML = tick;
    
    //화면에 출력한다 .
//    doXSLT();
  }  
  
  function testCase3() {
    //root 요소를 얻는다.
    var root = xmlDoc.documentElement;
    var tick = (new Date()).getTime();
    var newDoc = null;
    
    if (window.ActiveXObject) {
      newDoc = new ActiveXObject("MSXML.DOMDocument");
      for (var i=0;i<1000;i++) {
        newDoc.loadXML("<book><isbn>aaa</isbn><title>bbb</title><author>cccc</author></book>"); 
        root.appendChild(newDoc.documentElement);
      }
    } else {
      var parser = new DOMParser();
      for (var i=0;i<1000;i++) {
        newDoc = parser.parseFromString("<book><isbn>aaa</isbn><title>bbb</title><author>cccc</author></book>", "text/xml");
        root.appendChild(newDoc.documentElement);
      }
    }
    
    tick = (new Date()).getTime() - tick;
    document.getElementById("id3").innerHTML = tick;
    
    //화면에 출력한다 .
//    doXSLT();
  }  
  
  function testCase4() {
    //root 요소를 얻는다.
    var root = xmlDoc.documentElement;
    var book = root.childNodes[0];
    var newBook;
    var tick = (new Date()).getTime();
  
    for (var i=0;i<1000;i++) {
      newBook = book.cloneNode(true);
      //하위 요소 문자열을 변경한다.
      setNodeValue(newBook.childNodes[1], "12-1234-123-9");
      root.appendChild(newBook);
    }
    
    tick = (new Date()).getTime() - tick;
    document.getElementById("id4").innerHTML = tick;
    
    //화면에 출력한다 .
//    doXSLT();
  }  
  
  function testCase() {
    testCase1();
    testCase2();
    testCase3();
    testCase4();
  }
  
  window.onload = function() {
    loadBooks();
  }

  </script>
</head>
<body>
신규책 목록 
<div id="xmlList"></div>
<a href="javascript:testCase()">속도 테스트 </a>

<table border="1">
  <tr>
    <th>createElement()메소드를 이용한 객체 생성</th>
    <td><span id="id1">&nbsp</span></td>
  </tr>
  <tr>
    <th>cloneNode() 메소드를 이용한 객체 생성</th>
    <td><span id="id2">&nbsp</span></td>
  </tr>
  <tr>
    <th>문자열을 이용한 XML 노드 생성</th>
    <td><span id="id3">&nbsp</span></td>
  </tr>
  <tr>
    <th>cloneNode() 메소드를 이용한 객체 생성</th>
    <td><span id="id4">&nbsp</span></td>
  </tr>
</table>
</body>
</html>