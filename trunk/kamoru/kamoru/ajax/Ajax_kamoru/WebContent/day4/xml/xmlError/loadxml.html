<HTML>
<HEAD>
<TITLE> XML 구문 분석 중 오류 발생 처리 하기 </TITLE>

<SCRIPT LANGUAGE="JavaScript">

function createXMLDocFromString(str) {
  var xmlDoc = null;

  try {
    if (window.ActiveXObject) {
      //MS XML Document 객체 생성 가능 
      xmlDoc = new ActiveXObject("MSXML.DOMDocument");
      
      // 문자열로 XML 문서를 작성한다.
      xmlDoc.loadXML(str);
      
      //IE에서 오류 처리 하는 방법 
      if (xmlDoc.parseError.errorCode != 0) {
        var msg = "오류가 발생했습니다.\n";
        msg += "오류 코드 : " + xmlDoc.parseError.errorCode + "\n" ;
        msg += "오류 원인: " + xmlDoc.parseError.reason;
        alert(msg);
        return null;
      }
    } else {
      //파이어 폭스에서 XML Parser 객체 생성
      var parser = new DOMParser();
      xmlDoc = parser.parseFromString(str, "text/xml");

      //파이어 폭스에서 오류 처리하는 방법
      if (xmlDoc.documentElement.nodeName == "parsererror") {
        var msg = "오류가 발생했습니다.\n";
        msg += "오류 원인: " + xmlDoc.documentElement.childNodes[0].nodeValue;
        alert(msg);
        return null;
      }
    }
  } catch (e) {
    alert(e);
  }
  
  return xmlDoc;
} 

function nodeStr(node, tabs) {

    var msg = "";
    if (tabs == null) {
      tabs = "";
    }
    msg += tabs + "[노드이름 : "    + node.nodeName  + "]"
    msg += tabs + "[노드의 타입 : "  + node.nodeType  + "]"
    msg += tabs + "[노드문자 : "    + node.text      + "]"
    msg += tabs + "[노드의 값 : "    + node.nodeValue + "]\n"
    
    var nodeList = node.childNodes;

    if (nodeList != null ) {
      tabs += "\t";
      for(var i=0;i<nodeList.length;i++) {
          msg += "---------------------------------------------\n";
          msg += nodeStr(nodeList[i], tabs);
      }
    }
    return msg;

}

function loadBooks() {
    var xmlContents = document.getElementById("xmlContents");    
    var str = "";
    
    //문자열로 구성된 XML 문서 
    str += "<books>\n";
    str += "    <book>\n";
    str += "        <isbn>12-1234-123-1</isbn>\n";
    str += "        <title>AJAX 인 액션 </title>\n";
    str += "        <author>데이브 크레인, 에릭 파스칼렐로</author>\n";
    str += "    </book>\n";
    str += "    <book>\n";
    str += "        <isbn>12-1234-123-2</isbn>\n";
    str += "        <title>홍길동의 AJAX Programming </title>\n";
    str += "        <author>홍길동</author>\n";
//    str += "    </book>\n";
    str += "    <book>\n";
    str += "        <isbn>12-1234-123-3</isbn>\n";
    str += "        <title>한글판 Professional Ajax</title>\n";
    str += "        <author>Nicholas C. Zakas , Jeremy McPeak , Joe Fawcett</author>\n";
    str += "    </book>\n";
    str += "    <book>\n";
    str += "        <isbn>12-1234-123-4</isbn>\n";
    str += "        <title>타짜</title>\n";
    str += "        <author>허영만</author>\n";
    str += "    </book>\n";
    str += "    <book>\n";
    str += "        <isbn>12-1234-123-5</isbn>\n";
    str += "        <title>고구려 건국</title>\n";
    str += "        <author>주몽</author>\n";
    str += "    </book>\n";
    str += "</books>\n";
    
  xmlDoc = createXMLDocFromString(str);
  if (xmlDoc == null) return;
  
  //루트 노드를 얻는다.
  var root = xmlDoc.documentElement;
  var msg = "";
  if (root == null) return;
  
  msg = "하위 노드의 갯수 : " + root.childNodes.length + "\n";
  msg += nodeStr(root, "");
  
  xmlContents.value = msg;

}

</SCRIPT>

</HEAD>

<BODY onload="loadBooks();">

<h3>XML 구문 분석 중 오류 발생 처리 하기 </h3>
<hr>
읽어 들인 XML 문서<br/>
<textarea id='xmlContents' name='xmlContents' readonly="readonly" rows="20" cols="80" wrap="off"></textarea>

</BODY>
</HTML>
