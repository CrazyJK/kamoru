<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>제시어 기능 구현하기  </title>
<!--
create table tb_suggest (
	pid int auto_increment primary key	,
	keyword varchar(255),
	contents varchar(255), 
	rank int
);

insert into tb_suggest (keyword, contents, rank) values ('AJAX 초급       ', 'AJAX 초급       ', 1);
insert into tb_suggest (keyword, contents, rank) values ('AJAX 중급       ', 'AJAX 중급       ', 1);
insert into tb_suggest (keyword, contents, rank) values ('AJAX 고급       ', 'AJAX 고급       ', 1);
insert into tb_suggest (keyword, contents, rank) values ('wkqk'            , '자바            ', 1);
insert into tb_suggest (keyword, contents, rank) values ('자바            ', '자바            ', 1);
insert into tb_suggest (keyword, contents, rank) values ('자바 프로그래밍 ', '자바 프로그래밍 ', 1);   
insert into tb_suggest (keyword, contents, rank) values ('자바 서버 페이지', '자바 서버 페이지', 1);    
insert into tb_suggest (keyword, contents, rank) values ('자바스터디      ', '자바스터디      ', 1);
insert into tb_suggest (keyword, contents, rank) values ('자바서비스      ', '자바서비스      ', 1);
-->


  <script type="text/javascript" src="ajax.js"></script>
  <script type="text/javascript">

  var checkFirst = false;
  var lastKeyword = '';
  var loopSendKeyword = false;
  
  function startSuggest() {
    if (checkFirst == false) {
      setTimeout("sendKeyword();", 500);
      loopSendKeyword = true;
    }
    checkFirst = true;
  }
  function sendKeyword() {
    if (loopSendKeyword == false) return;
    
    var keyword = document.search.keyword.value;
    if (keyword == '') {
      lastKeyword = '';
      hide('suggest');
    } else if (keyword != lastKeyword) {
      lastKeyword = keyword;
      
      if (keyword != '') {
        //응답 인자를 JSON 표기법으로 생성 한다.
        var params  = {"keyword" : keyword};
      
        //웹서버의  seggest.jsp를 호출 할때 요청 인자 전달하고 호출방식은 POST 방식으로 한다. 
        //응답결과는 displayResult 함수에서 처리한다.
         new ajax.xhr.Request("suggest.jsp", params, displayResult, "POST");
      } else {
        hide('suggest');
      }
    }
    setTimeout("sendKeyword();", 500);
  }

  function trim(s) {
	    s = s.replace(/(^\s*)|(\s*$)/g,"");
	    return s;
	}
  
  function displayResult(req) {
    if (req.readyState == 4) {
      if (req.status == 200) {
        var resultText = req.responseText;
        var result = resultText.split(',');
        
        var count = result != null ? result.length : 0;
        if (count == 0) {
          hide('suggest');
        } else {
          var html = '';
          var str;
          for (var i = 0 ; i < result.length ; i++) {
            str = trim(result[i]); 
            html += "<a href=\"javascript:select('"+
                    str+"')\">"+
                    str+"</a><br/>";
          }
          var listView = document.getElementById('suggestList');
          listView.innerHTML = html;
          
          show('suggest');
        }
      } else {
        alert("에러 발생: "+req.status);
      }
    }
  }
  function select(selectedKeyword) {
    document.search.keyword.value = selectedKeyword;
    loopSendKeyword = false;
    checkFirst = false;
    hide('suggest');
  }
  function show(elementId) {
    var element = document.getElementById(elementId);
    if (element) {
      element.style.display = '';
    }
  }
  function hide(elementId) {
    var element = document.getElementById(elementId);
    if (element) {
      element.style.display = 'none';
    }
  }

  function getRealLeft(obj) {
	  if (obj == null) {
		  return 0;
	  } else if (obj.nodeName == "HTML" || obj.nodeName == "FORM") {
		  return 0; 
	  }
	  return (obj.offsetLeft + getRealLeft(obj.parentNode));
  }
  
  function getRealTop(obj) {
	  if (obj == null) {
		  return 0;
	  } else if (obj.nodeName == "HTML" || obj.nodeName == "FORM") {
		  return 0; 
	  }
	  return (obj.offsetTop + getRealTop(obj.parentNode));
  }
  
  window.onload = function() {
	  	var keyword = document.getElementById("keyword");
	  	var suggest = document.getElementById("suggest");
	  	suggest.style.left = getRealLeft(keyword) + "px"; 
	  	suggest.style.top = (getRealTop(keyword)  + keyword.offsetHeight) + "px"; 
  }
 
  </script>
  <style>
  #view {
    border: 1px solid #999;
  }
  </style>
 </head>
<body  style="margin:0px">
<h3 >제시어 기능 구현하기 </h3>
<hr>
<form name="search"  >
  11111111111111111111111111<input type="text" name="keyword" id="keyword" onkeydown="startSuggest()"> 
  <input type="button" value="검색" >
  <!--  서버가 전송한 제시어 목록을 출력하는 영역 -->
  <div id="suggest" style="display:; position: absolute; top:110px; left:10px; background-color: aqua; width: 150px">
  	<div id="suggestList"></div>
  </div>
</form>
</body>
</html>