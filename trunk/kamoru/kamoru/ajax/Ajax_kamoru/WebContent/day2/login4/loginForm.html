<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
<script type="text/javascript">
var req = null;

function jsSubmit(){

	if(window.XMLHttpRequest){
		req = new XMLHttpRequest();
	}else{
		if(window.ActiveXObject){
			try{
				req = new ActiveXObject("msxml2.XMLHTTP");
			}catch(e){
				req = new ActiveXObject("microsoft.XMLHTTP");
			}
		}	
	}

	if(null == req){
		alert("XMLHttpRequest 객체 생성 오류");
		return;
	}

	var param = "?uid=" + loginForm.uid.value + "&pwd=" + loginForm.pwd.value;
	req.open("GET", "login.jsp" + param, true);
	req.onreadystatechange = callback;
	req.send(null);

	return false;
}

function jsLogout(){
	if(req == null){
		if(window.XMLHttpRequest){
			req = new XMLHttpRequest();
		}else{
			if(window.ActiveXObject){
				try{
					req = new ActiveXObject("msxml2.XMLHTTP");
				}catch(e){
					req = new ActiveXObject("microsoft.XMLHTTP");
				}
			}	
		}
	}
	
	if(null == req){
		alert("XMLHttpRequest 객체 생성 오류");
		return;
	}

	req.open("GET", "logout.jsp", true);
	req.onreadystatechange = callback_logout;
	req.send(null);
}

function callback(){
	if(req.readyState == 4 && req.status == 200){
		//서버로 부터 결과를 가져와 처리하는 부분
		//{result : 1, name : ''} 성공
		//{result : -1, name : ''} 비밀번호 틀림
		//{result : -2, name : ''} 아이디 틀림
//		var result = eval('(' + '{result:1, name:"홍길동"}' + ')');//req.responseText;
		var result = eval('(' + req.responseText + ')');//;
		switch(result.code){
		case 1:
			var loginForm = document.loginForm;
			var logoutPanel = document.getElementById("logoutPanel");
			loginForm.style.display = "none";
			logoutPanel.style.display = "";
			break;
		case -1:
			alert("비밀번호가 잘못되었습니다.");
			break;
		case -2:
			alert("아디디가 잘못되었습니다.");
			break;
		}		
	}else if(req.readyState == 4 && req.status != 200){
		alert(req.status);
	}
}

function callback_logout(){
	if(req.readyState == 4 && req.status == 200){
		var loginForm = document.loginForm;
		var logoutPanel = document.getElementById("logoutPanel");

		loginForm.style.display = "";
		logoutPanel.style.display = "none";
	}
}

function jsLoad(){
	//DOM 레벨 0 - 객체에 대고 함수를 매핑하는 거...
	document.loginForm.onsubmit=function(){return jsSubmit();};
	var logout = document.getElementById("logout");
	logout.onclick=function(){jsLogout());
}
</script>
</head>
<body onload="jsLoad()">
<h3>Ajax 이용 로그인 처리</h3>

<form name="loginForm" method="post" action="login.jsp" style="position: absolute;top:200pt;left:300pt;">
아이디   : <input type="text" name="uid"/><br>
비밀번호 : <input type="password" name="pwd"/><br>
<input type="submit" value="로그인"/>
<input type="reset" value="초기화"/>
</form>

<div id="logoutPanel" style="display:none; position: absolute;top:200pt;left:300pt;">
<a href="javascript:void(0)" id=logout">홍길동</a>님 환영합니다.
</div>

<iframe src="main.jsp"></iframe>
</body>
</html>