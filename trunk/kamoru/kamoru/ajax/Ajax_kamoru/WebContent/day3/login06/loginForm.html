<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
<script type="text/javascript">
var req = null;

function getXMLHttpRequest() {
	if (window. XMLHttpRequest) {
		return new XMLHttpRequest();
	} else {
		//ie 6.0 이하 버전  
		if (window.ActiveXObject) {
			try {
				//ie 6.0 버전
				return new ActiveXObject("msxml2.XMLHTTP");
			} catch (e) {
				//ie 5.0 이하 버전
				return new ActiveXObject("microsoft.XMLHTTP");
			}
		}
	}
	return null;
}

function sendRequest(url, arg, callbackFunc, method)   {
	req = 	getXMLHttpRequest();
	if (null == req) {
		alert("XMLHttpReqeust 객체를 생성할 수 없습니다.");
		return ;
	}

	if (method == "POST") {
		req.open("POST", url, true);
		req.onreadystatechange = callbackFunc; 
		req.setRequestHeader(
				'Content-Type', 'application/x-www-form-urlencoded');
		req.send(arg);
	} else  {
		req.open("GET", url + "?" + arg, true);
		req.onreadystatechange = callbackFunc; 
		req.send(null);
	}
		
	
}

function callback() {
	if (req.readyState == 4 && req.status == 200) {
		//서버 페이지로 부터 결과 얻는부분
		var result = eval('(' + req.responseText + ')');//req.responseText;
		switch(result.code) {
		case 1:
			var loginForm = document.loginForm;
			var logoutPanel =  document.getElementById("logoutPanel");

			loginForm.style.display = "none";
			logoutPanel.style.display = "";
			break;
		case -1:
			alert("비밀번호가 잘못되었습니다.");
			break;
		case -2:
			alert("아이디가 존재하지 않습니다.");
			break;
		}	
		 
	} else if( req.readyState == 4 && req.status != 200) {
		alert(req.status);
	}
}


function jsSubmit() {
	var loginForm = document.loginForm;
	var logoutPanel =  document.getElementById("logoutPanel");

	var param = "uid=" + loginForm.uid.value + "&pwd=" + loginForm.pwd.value 

	sendRequest("login.jsp", param, callback, "POST"); 
	return false;
}

function jsLogout() {
	sendRequest("logout.jsp", null, callback_logout); 
	return false;
}

function callback_logout() {
	if (req.readyState == 4 && req.status == 200) {
		var loginForm = document.loginForm;
		var logoutPanel =  document.getElementById("logoutPanel");

		loginForm.style.display = "";
		logoutPanel.style.display = "none";

//		loginForm.uid.value = "";
//		loginForm.pwd.value = "";

		loginForm.reset();
		loginForm.uid.focus();
	} else if( req.readyState == 4 && req.status != 200) {
		alert(req.status);
	}
}

window.onload = function () {
	document.loginForm.onsubmit=function () {return jsSubmit()};	
	var logout = document.getElementById("logout");
	logout.onclick = jsLogout;
}

</script>
</head>

<body>
<form name="loginForm" method="post" action="login.jsp" >
	아이디 : <input type="text" name="uid"/><br/>
	비밀번호: <input type="password" name="pwd"/><br/>
	<input type="submit" value="로그인"/>
	<input type="reset" value="초기화"/>
</form>

<div id="logoutPanel" style="display:none">
<a href="javascript:void(0)" id="logout" >홍길동</a>님 환영합니다.
</div>

</body>
</html>