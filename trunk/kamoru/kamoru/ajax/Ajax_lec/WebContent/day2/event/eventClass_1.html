<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>클래스 메소드로 이벤트 핸들러 구현</title>
  <style type="text/css">
    #btn {
      padding: 50px;
      font-size: 50px;
    }
  </style>
    <script type="text/javascript" src="event.js" ></script>
  <script type="text/javascript" >
	/*
	 event handler를 클래스의 메소드를 할때 
	 	발생되는 문제 
	 	
	 1. event handler 일반함수 
	 		this -> document, event 객체, window

	 2. event handler -> class method 호출 
	    일반 함수를 call, apply() 함수 
	    class의 private 멤버 변수 (local 변수)
	*/
    
  window.onload = function () {
    //var btn = document.getElementById("btn");
    //Event.addListener(btn, "click", btn_click);
    
    //ButtonClass 클래스를 Event이용하여 객체를 생성한다.
    //new ButtonClass("btn");
    //new ButtonClass2("btn");
    new ButtonClass3("btn");
  }
 
 
  //이벤트 핸들러를 일반 함수 형태로 구현한 경우 
  function btn_click(e) {
    var event = event || e;
    alert(this == document); 
  }
  
  //이벤트 핸들러를 클래스화 경우 1 (잘못된 경우)
  //클래스 정의 한다
  ButtonClass = function(id) {
    //아이디를 이용하여 객체를 얻어 멤버 변수 element에 설정한다.
    this.element = document.getElementById(id);
    //객체에 click 이벤트 핸들러를 클래스의 멤버 함수로 등록한다.
    Event.addListener(this.element, "click", this.onclick);
  }
  
  ButtonClass.prototype = {
    onclick : function(e) {
      //클래스의 멤버 변수 element에 있는 객체의 스타일 중 배경색을 변경한다.
      this.element.style.background = "blue";
    }
  }

  //일반함수를 클래스의 메소드화하는 방법 
  /*
  function MyFunction() {
     alert(this.msg);
  }
  var obj = new Object() ;
  obj.msg = "안녕하세요" ;
  MyFunction.call(obj) ;
  //또는 
  MyFunction.apply(obj) ;
//*/

/*
  MyClass = function() {
    this.msg = "";
    
    MyFunction = function() {
      alert(this.msg);
    }
  }

  var obj = new MyClass();
  obj.msg = "안녕하세요";
  obj.MyFunction();
  //MyFunction.call(obj);
//*/  
  
	
/*
  function MyFunction(v1, v2) {
     alert(this.msg);
     alert('v1 = ' + v1);
     alert('v2 = ' + v2);
  }
  var obj = new Object() ;
  obj.msg = "안녕하세요" ;
  MyFunction.call(obj, 10, 20) ;
  //또는 
  MyFunction.apply(obj, new Array(10, 20)) ;
//    MyFunction.apply(obj, [10, 20]) ;
  //*/
    
  
  //[객체].[메소드](인자);
  //c++/java의 함수호출 내부 구조 
  //일반함수(장식문자)(this, 인자);

  //이벤트 핸들러를 클래스화 경우 2(정상적인 경우)
  //클래스 정의 한다
  
  ButtonClass2 = function(id) {
    this.element = document.getElementById(id);
    var localThis = this ; 
    
    clickHandler = function () {
       localThis.onclick.apply(localThis, arguments) ;
    }
    Event.addListener(this.element, "click", clickHandler);
  }

  ButtonClass2.prototype = {
    onclick : function(e) {
      this.element.style.background = "blue";
    }
  }

  //이벤트 핸들러를 클래스화 경우 3(정상적인 경우)
  //클래스 정의 한다
  ButtonClass3 = function(id) {
    this.element = document.getElementById(id);
    
    Event.addListener(this.element
      , "click"
      , Event.bindAsListener(this, this.onclick));
  }
  
  ButtonClass3.prototype = {
    onclick : function(e) {
      this.element.style.background = "blue";
    }
  }
    
  </script>
</head>
<body>
<h3>클래스 메소드로 이벤트 핸들러 구현</h3>
<hr/>
  <input type="button" id="btn" value="클릭해주세요" >
</body>
</html>