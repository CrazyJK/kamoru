<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
<style type="text/css">
    .normal {
      background-color: #FFFFFF;
    }
    .select {
      background-color: red;
    }
</style>
<script type="text/javascript" src="ajax.js"></script>
<script type="text/javascript" src="event.js"></script>
<script type="text/javascript">
//마우스 선택에 대한 위치 이동 기능 구현  
var curRow = 0;
var curCol = 0;

window.onload=function() {
  var t1 = document.getElementById("t1");
  
  Event.addListener(t1, "click", onclick_table);
  Event.addListener(document, "keydown", onkeydown_table);
}

onkeydown_table = function(e) {
    var event  = window.event || e;
    var row, col;
    var c = document.getElementById("t1");
    
    row = t1.rows(curRow);
    if (!row) return;
    col = row.cells(curCol);
    if (!col) return;
    col.className = "normal";

    switch (event.keyCode) {
    case 37: // arrow left
        curCol--;
        if (curCol <= 0) {
          curCol = 0;
        }
        break;
    case 38: // arrow up
        curRow--;
        if (curRow <= 0) {
          curRow = 0;
        }
        break;
      case 39: // arrow right 
        curCol++;
        if (curCol > 5) {
          curCol = 5;
        }
        break;
      case 40: // arrow down
          curRow++;
          if (curRow > 5) {
            curRow = 5;
          }
          break;
    }
    
    row = t1.rows(curRow);
    if (!row) return;
    col = row.cells(curCol);
    if (!col) return;
    col.className = "select";
    
}
  
onclick_table = function(e) {
  var table = document.getElementById("t1");
  var row = table.rows(curRow);
  if (!row) return;
  var col = row.cells(curCol);
  if (!col) return;
  col.className = "normal";
	  
  var event  = window.event || e;
  col = Event.target(event);
  var inputs = col.getElementsByTagName("INPUT");
  var input;
  row = col.parentNode;

  if (null == row) return;

  curRow = row.rowIndex;
  curCol = col.cellIndex;
  
  var row = table.rows(curRow);
  if (!row) return;
  var col = row.cells(curCol);
  if (!col) return;
  col.className = "select";
  
  if (!inputs.length || inputs.length == 0) {
    col.innerHTML= "<input type='text' value='"+col.innerHTML+"'>";
    
    //입력상자의 객체를 얻는다.
    input = col.getElementsByTagName("INPUT")[0];
    Event.addListener(input, "blur", onblur_input);
    Event.addListener(input, "keydown", onkeydown_input);
    input.focus();
  }
  
  //현재이벤트 핸들러에서 작업을 멈춘다.
  Event.stopEvent(event);
    
}

onblur_input = function(e) {
  var event  = window.event || e;
  var input = Event.target(event);
  var col = getParentNode("TD", input);
  
  if (col == null) return;
  
  col.innerHTML = input.value;
  
  //서버에 전송할 인자를 JSON 구문으로 구성한다.
  var param = {id : col.getAttribute("id")
      , text : col.innerHTML 
  }
  //서버에 자료를 전송한다.
  new  ajax.xhr.Request("sendData.jsp", param, onsend_data, "GET");


  //현재이벤트 핸들러에서 작업을 멈춘다.
  Event.stopEvent(event);
}

function onsend_data(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        var result = reg.responseText;
      }
    }
}

function onkeydown_input(e) {
  var event  = window.event || e;
  var input = Event.target(event);
  
  if (e.keyCode == 13) {
    input.blur();
    //현재이벤트 핸들러에서 작업을 멈춘다.
    Event.stopEvent(event);
  }
}

getParentNode = function(nodeName, child) {
  if (null == child) {
    return null;
  }
  if (child.parentNode == null) {
    return null;
  }
  
  if (child.parentNode.nodeName == nodeName) {
    return child.parentNode;
  }
  
  return getParentNode(nodeName, child.parentNode);
}


</script>
</head>
<body>

<table id="t1" border="1" cellpadding="1" cellspacing="1">
  <tr>
    <td width="100" id="01" class="select">0_0</td>
    <td width="100" id="02">0_1</td>
    <td width="100" id="03">0_2</td>
    <td width="100" id="04">0_3</td>
    <td width="100" id="05">0_4</td>
    <td width="100" id="06">0_5</td>
  </tr>
  <tr>
    <td width="100" id="07">1_0</td>
    <td width="100" id="08">1_1</td>
    <td width="100" id="09">1_2</td>
    <td width="100" id="10">1_3</td>
    <td width="100" id="11">1_4</td>
    <td width="100" id="12">1_5</td>
  </tr>
  <tr>
    <td width="100" id="13">2_0</td>
    <td width="100" id="14">2_1</td>
    <td width="100" id="15">2_2</td>
    <td width="100" id="16">2_3</td>
    <td width="100" id="17">2_4</td>
    <td width="100" id="18">2_5</td>
  </tr>
  <tr>
    <td width="100" id="19">3_0</td>
    <td width="100" id="20">3_1</td>
    <td width="100" id="21">3_2</td>
    <td width="100" id="22">3_3</td>
    <td width="100" id="23">3_4</td>
    <td width="100" id="24">3_5</td>
  </tr>
  <tr>
    <td width="100" id="25">4-0</td>
    <td width="100" id="26">4-1</td>
    <td width="100" id="27">4-2</td>
    <td width="100" id="28">4-3</td>
    <td width="100" id="29">4-4</td>
    <td width="100" id="30">4-5</td>
  </tr>
  <tr>
    <td width="100" id="31">5_0</td>
    <td width="100" id="32">5_1</td>
    <td width="100" id="33">5_2</td>
    <td width="100" id="34">5_3</td>
    <td width="100" id="35">5_4</td>
    <td width="100" id="36">5_5</td>
  </tr>
</table>

</body>
</html>