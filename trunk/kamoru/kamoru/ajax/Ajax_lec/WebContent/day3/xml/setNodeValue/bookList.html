<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
  <title>노드 문자열 바꾸기 </title>
  <script type="text/javascript" src="ajax.js"></script>
  <script type="text/javascript">
  var xmlDoc = null;
  var xslDoc = null;

  function loadBooks() {
  new  ajax.xhr.Request("books.jsp", null, loadBooksXML, "GET");
    new  ajax.xhr.Request("books.xsl", null, loadBooksXSL, "GET");
  }
    
  function loadBooksXML(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        xmlDoc = reg.responseXML;
        doXSLT();
      }
    }
  }
  
  function loadBooksXSL(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        xslDoc = reg.responseXML;
        doXSLT();
      }
    }
  }
  
  function doXSLT() {
    if (xmlDoc == null || xslDoc == null) return;
    
    var msg_id = document.getElementById("xmlList");
    
    if (window.ActiveXObject) {
      msg_id.innerHTML = xmlDoc.transformNode(xslDoc);
    } else {
      var xsltProc = new XSLTProcessor();
      xsltProc.importStylesheet(xslDoc);
      var fragment = xsltProc.transformToFragment(xmlDoc, document);
      msg_id.innerHTML = "";
      msg_id.appendChild(fragment);
    }
  } 

  //부모노드을 입력 인자로 해서 하위 노드의 문자열을 얻는다 .
  function setNodeValue(node, value) {
    if (node == null) return ;
    
    var childList = node.childNodes;
    for (var i=0;i<childList.length;i++) {
      //node의 value을 변견한다.
      if (childList[i].nodeType == 3) {
        childList[i].nodeValue = value;
      }
    }
  }
  
  function getNodeValue(node) {
    if (node == null) return "";
    
    var childList = node.childNodes;
    for (var i=0;i<childList.length;i++) {
      //node의 value을 변견한다.
      if (childList[i].nodeType == 3) {
        return childList[i].nodeValue;
      }
    }
    return "";
  }
  
  function elementSetNodeValue() {
    //root 요소를 얻는다.
    var root = xmlDoc.documentElement;
    //루트 노드의 첫번째 자식 노드 얻는다.
    var book = root.childNodes(0);
    //book의 복제본을 얻는다.
    //즉 새로운 노드를 생성한다.
    var newBook = book.cloneNode(true);

    //하위 요소 문자열을 변경한다.
    setNodeValue(newBook.childNodes(0), "12-1234-123-9");
    setNodeValue(newBook.childNodes(1), "새로운 책");
    setNodeValue(newBook.childNodes(2), "저자");

    //새로운 요소 객체를 마지막 위치에 삽입한다.
    root.appendChild(newBook);
        
    //화면에 출력한다 .
    doXSLT();
  }  

  window.onload = function() {
    loadBooks();
  }

  </script>
</head>
<body>
노드 문자열 바꾸기   
<div id="xmlList"></div>
<a href="javascript:elementSetNodeValue()">[노드의 문자열 바꾸기 ]</a>
</body>
</html>
