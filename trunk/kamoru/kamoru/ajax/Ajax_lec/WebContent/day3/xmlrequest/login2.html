<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title> 로그인 </title>
<script type="text/javascript" src="ajax.js"></script>
<script type="text/javascript" >

function login() {
  var uid = document.getElementById("UID");
  var pwd = document.getElementById("PWD");
  var args = "UID=" + uid.value + "&PWD=" + pwd.value;
  //json 표기법으로 전송할 인자를 생성한다.
  var param = {UID : uid.value, PWD : pwd.value}; 
	
  new ajax.xhr.Request("login.jsp",
  		param,
  		callbackFunction,
  		"GET");
/*
  httpRequest = getXMLHttpRequest();
  httpRequest.onreadystatechange = callbackFunction;
  httpRequest.open("GET", "login.jsp?" + args, true);
  httpRequest.send(null);
*/
}

function trim(s) {
	s = s.replace(/(^\s*)|(\s*$)/g,"");
    return s;
}

var orgLoginForm;

function callbackFunction(httpRequest) {
   switch (httpRequest.readyState) {
   case 1:
   case 2:
   case 3:
   	 break;
   case 4:
        //서버로부터 응답 도착 
        if (httpRequest.status == 200) {
        	//처리
        	var result = trim(httpRequest.responseText);
        	var arr = result.split(",");
        	//alert(arr[0]);//상태코드
        	//alert(arr[1]);//결과문자열
        	if (arr.length != 2) {
        		alert("알수 없는 오류"); 
        	} else {
        		if (arr[0] == "1") {
        			//성공에 대한 처리
        			var html;
        			var loginPanel = document.getElementById("loginPanel");
        			html = "사용자 : " + arr[1] + "<br>";
        			html += "<input type='button' value='로그아웃' onclick='logout()'>";
        			
        			orgLoginForm = loginPanel.innerHTML;  	
        			loginPanel.innerHTML = html;
        			
        		} else {
        			//경고 메시지 출력
        			alert(arr[1]);
        		}
        	}
        }
        break;
   }
}

function logout() {
	var loginPanel = document.getElementById("loginPanel");
	var html = loginPanel.innerHTML;
	loginPanel.innerHTML = orgLoginForm;
	
	var uid = document.getElementById("UID");
	uid.value = "";
	uid.focus();
}


</script>
</head>
<body>

<h3>로그인</h3>
<hr>

<br/>

<div id="loginPanel">
	아이디 : <input type="text" name="UID" id="UID" maxlength="8"> <br/>
	비밀번호  : <input type="password" name="PWD" id="PWD" maxlength="8"> <br/>
	<input type="button" value="로그인" onclick="login()">
	
</div>


</body>
</html>