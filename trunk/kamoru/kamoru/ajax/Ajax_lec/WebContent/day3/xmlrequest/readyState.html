

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>readyState값에 따른 콜백함수 호출 </title>
<script type="text/javascript" >
//httpRequest 전역 변수 선언
var httpRequest = null;

//XMLHttpRequest 객체 얻는 함수
function getXMLHttpRequest() {
  if (window.ActiveXObject) {
    //IE에서 XMLHttpRequest 객체 구하기 
    try {
      return new ActiveXObject("MSXML2.XMLHTTP");
    } catch (e) {
      try {
        return new ActiveXObject("Microsoft.XMLHTTP");
      } catch (e1) {
        return null;
      }
    }
  } else if (window.XMLHttpRequest) {
    //IE를 제외한 파이어 폭스, 오페라와 같은 브라우저에서 XMLHttpRequest 객체를 구한다.
    return new XMLHttpRequest;
  }
  
  return null;
}

function sendProcess(a) {

	httpRequest = getXMLHttpRequest();
  httpRequest.onreadystatechange = function () {
	  var debug = document.getElementById("debug");
	   switch (httpRequest.readyState) {
	   case 1:
	   case 2:
	   case 3:
	   //진행상태 처리 작업 
	        debug.value += httpRequest.readyState + " : Interactive\n";
	        break;
	   case 4:
		   switch(a) {
		   case 1:
			   alert("AAAAAAAAAAAAAAA");
			   break;
		   case 2:
			   alert("BBBBBBBBBBBBBBBBB");
			   break;
		   }
	        //서버로부터 응답 도착 
	        debug.value += "Complate\n";
	        break;
	   }
	}

  httpRequest.open("GET", "/hello.jsp", true);
  httpRequest.send(null);
}

function callbackFunction() {
  var debug = document.getElementById("debug");
   switch (httpRequest.readyState) {
   case 1:
   case 2:
   case 3:
   //진행상태 처리 작업 
        debug.value += httpRequest.readyState + " : Interactive\n";
        break;
   case 4:
	   switch(g_a) {
	   case 1:
		   break;
	   case 2:
		   break;
	   }
        //서버로부터 응답 도착 
        debug.value += "Complate\n";
        break;
   }
}

function clear_onclick() {
  var debug = document.getElementById("debug");
  debug.value="";
}
</script>
</head>
<body>

<h3>readyState값에 따른 콜백함수 호출 </h3>
<hr>

<textarea rows="10" cols="80" id="debug" name="debug"></textarea>
<br/>
<input type="button" value="초기화" onclick="clear_onclick()">
<input type="button" value="서버호출" onclick="sendProcess(1)">
<input type="button" value="서버호출" onclick="sendProcess(2)">
</body>
</html>