<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
  <title>XML 노드를 찾아 XSTL 또는 DHTML을 이용한 화면 출력</title>
  <script type="text/javascript" src="ajax.js"></script>
  <script type="text/javascript">
  var xmlObj = new ajax.xml.Document();
  
  //XML 문서를 읽어 화면에 출력한다.  
  function loadXML() {
	  new  ajax.xhr.Request("product.jsp", null, loadProductXML, "GET");
    new  ajax.xhr.Request("product.xsl", null, loadProductXSL, "GET");
  }
    
  function loadProductXML(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        xmlObj.xmlDoc = reg.responseXML;
        doXSLT();
      }
    }
  }
  
  function loadProductXSL(reg) {
    if (reg.readyState == 4) {
      if (reg.status == 200) {
        xmlObj.xslDoc = reg.responseXML;
        doXSLT();
      }
    }
  }

  function doXSLT() {
    if (xmlObj.xmlDoc == null || xmlObj.xslDoc == null) return;
    
    //XML 객체를 문자열로 출력한다.
    var xmlList = document.getElementById("xmlList");
    
    //nacespace를 설정한다 .
    xmlObj.setNamespace("xmlns:a='http://www.multicampus.or.kr/a' xmlns:b='http://www.multicampus.or.kr/b'");

  }
  
  window.onload = function() {
    loadXML();
  }
  
  function isValidCheck() {
    var from  = document.getElementById("from");
    var to    = document.getElementById("to");
    
    if (from.value == "") {
      alert("시작값을 넣어주세요");
      from.focus();
      return false;
    }
    if (to.value == "") {
      alert("종료을 넣어주세요");
      to.focus();
      return false;
    }
    return true;
  }
  
  function test1() {
    //조회 조건을 확인 후 인자가 있으면 실행하고 없으면 종료합니다.
    if (!isValidCheck()) return;

    //조회 조건 시작값과 끝값을 얻는다.
    var from  = parseInt(document.getElementById("from").value);
    var to    = parseInt(document.getElementById("to").value);
    var nodes = xmlObj.getElementsByTagName("product");
    var searchList = document.getElementById("searchList");
    var innerHTML = "";
    var i;
    
	//시작위치를 찾는다.
    for (i=0;i<nodes.length;i++) {
      if (parseInt(nodes[i].getAttribute("id")) == from) {
        break;
      }
    }
    
    innerHTML = "<h4>DHTML 이용한 출력</h4>";
    innerHTML += "<table border='1' cellspacing='0' cellpading='0'>";
    innerHTML += "<tr>";
    innerHTML += "<th>id</th>";
    innerHTML += "<th>이름</th>";
    innerHTML += "<th>가격</th>";
    innerHTML += "</tr>";
    
    for (;i<nodes.length;i++) {
      //id가 조건에 만족을 하면 출력할 DHTML 구문을 작성한다.
      if (parseInt(nodes[i].getAttribute("id")) <= to) {
        innerHTML += "<tr>";
        innerHTML += "<td>" + nodes[i].getAttribute("id") + "</td>";
        innerHTML += "<td>" + xmlObj.getNodeValue(nodes[i], "name") + "</td>";
        innerHTML += "<td>" + xmlObj.getNodeValue(nodes[i], "price") + "</td>";
        innerHTML += "</tr>";
      } else {
        //id가 조건에 만족을 하지 않으면 루프를 종료한다.
        break;
      }
    }
    innerHTML += "</table>";
    searchList.innerHTML = innerHTML;

  }

  function test2() {
    //조회 조건을 확인 후 인자가 있으면 실행하고 없으면 종료합니다.
    if (!isValidCheck()) return;

    //조회 조건 시작값과 끝값을 얻는다.
    var from  = document.getElementById("from").value;
    var to    = document.getElementById("to").value;

    //조회 조건에 맞는 노드 배열을 얻는다.
    var nodes = xmlObj.selectNodes(".//product[(@id >= " + from + ") and (@id <= " + to + ")]");

    //조회 결과가 없으면 메소드를 종료한다.
    if (nodes == null || nodes.length == 0) return;
    
    //조회된 배열 노드를 XSTL를 적용하여 화면에 출력한다.
	xmlObj.transformNodes(document.getElementById("searchList"), nodes);

  }

  </script>
</head>
<body>
<h3>XML 노드를 찾아 XSTL 또는 DHTML을 이용한 화면 출력</h3>

<div id="searchList"></div>
<br/>
조회조건(id) : 
<input type="text" name="from" id="from" value="1"> ~ <input type="text" name="to" id="to" value="10"><br/>
<input type="button" value="DHTML을 이용한 생성" onclick="test1()">
<input type="button" value="XSLT를 이용한 생성" onclick="test2()">


</body>
</html>