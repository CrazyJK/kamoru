<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
  <title>XPath를 이용한 노드 찾기</title>
  <script type="text/javascript">
  //XML 객체를 관리할 전역변수 
  var xmlDoc = null;
  
  function createXMLDocFromURL(url) {
    var xmlDoc = null;
    
    if (window.ActiveXObject != null) {
      //MS XML Document 객체 생성 가능 
      xmlDoc = new ActiveXObject("MSXML.DOMDocument");
      //동기 모드로 XML 문서 읽기 설정
      xmlDoc.async = false;
      
      // xml 을 파일로 불러올때.
      xmlDoc.load(url);
      //IE에서 오류 처리 하는 방법 
      if (xmlDoc.parseError.errorCode != 0) {
        var msg = "오류가 발생했습니다.\n";
        msg += "오류 코드 : " + xmlDoc.parseError.errorCode + "\n" ;
        msg += "오류 원인: " + xmlDoc.parseError.reason;
        alert(msg);
        return null;
      }
    } else {
      //파이어 폭스에서 XML Document 객체 생성
      var xmlDoc = document.implementation.createDocument("", "", null);
      //동기 모드로 XML 문서 읽기 설정
      xmlDoc.async = false;
      
      // xml 을 파일로 불러올때.
      xmlDoc.load(url);

      //파이어 폭스에서 오류 처리하는 방법
      if (xmlDoc.documentElement.nodeName == "parsererror") {
        var msg = "오류가 발생했습니다.\n";
        msg += "오류 원인: " + xmlDoc.documentElement.childNodes[0].nodeValue;
        alert(msg);
        return null;
      }
    }
      
    return xmlDoc;
  } 

  //XML 객체로 부터 문자열을 얻는다.
  function toString(xmlDoc) {
    //MS XML document일 경우 xml Document로 부터 문자열을 얻는다.
    if (xmlDoc.xml) {                                            
      return xmlDoc.xml;                                         
    } else {                                                     
      //파이어 폭스 일 경우                                      
      var serial = new XMLSerializer();                          
      return serial.serializeToString(xmlDoc);                   
    }                                                            
    return "";                                                   
  }

  //XML 문서를 읽어 화면에 출력한다.  
  function loadXML() {
    //XML 파일명을 기술한다  
    xmlDoc = createXMLDocFromURL("product.xml");
    if (xmlDoc == null) return;
    
    //XML 객체를 문자열로 출력한다.
    var xmlContents = document.getElementById("xmlContents");    
    xmlContents.value = toString(xmlDoc);
    
  }
  
  //노드의 문자열 값을 얻는다.  
  function getNodeValue(node, name) {
    if (node == null) return "";
    var str = "";

    var childNodes = node.childNodes;
    for (var i=0;i<childNodes.length;i++) {
      if (childNodes[i].nodeType == 3 && null == name) {
        return str + childNodes[i].nodeValue;
      } else if (childNodes[i].nodeType == 1 && childNodes[i].nodeName == name) {
        return str + getNodeValue(childNodes[i]);        
      }
    }
    return str;
  }

  function nodeOutput(node) {
    var xmlOutput = document.getElementById("xmlOutput");    
    var msg;
    msg = "id : " + node.getAttribute("id");
    msg += "\nname :" + getNodeValue(node, "name");
    msg += "\nprice :" + getNodeValue(node, "price");
    
    xmlOutput.value = msg;
  }

  function locationFilter1() {
	var expr = document.createExpression(".//product[1]", null);
    var result = expr.evaluate( xmlDoc.documentElement, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
    var product = result.singleNodeValue;
    
    if (null == product) {
     var xmlOutput = document.getElementById("xmlOutput");    
      xmlOutput.value = "product[1]의 노드를 찾을 수 없습니다."
    } 
    
    nodeOutput(product);    
  }

  function locationFilterLast() {
    var result = xmlDoc.evaluate(".//product[last()]", xmlDoc.documentElement, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
    var product = result.singleNodeValue;
    
    if (null == product) {
      var xmlOutput = document.getElementById("xmlOutput");    
      xmlOutput.value = "product[last()]의 노드를 찾을 수 없습니다."
    } 
    
    nodeOutput(product);    
  }

  function locationFilterAttribute1() {
    var result = xmlDoc.evaluate(".//product[@id='1']", xmlDoc.documentElement, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
    var product = result.singleNodeValue;
    
    if (null == product) {
      var xmlOutput = document.getElementById("xmlOutput");    
      xmlOutput.value = "product[@id='1']의 노드를 찾을 수 없습니다."
    } 
    
    nodeOutput(product);    
  }

  function locationFilterExistAttribute() {
    var resultSet = xmlDoc.evaluate(".//product[@id]", xmlDoc.documentElement, null, XPathResult.ORDERED_NODE_ITERATOR_TYPE, null);
    //출력용 textarea 이다.
    var xmlOutput = document.getElementById("xmlOutput");    
    var msg = "";
    var node;//= resultSet.iterateNext();
    while (null != (node = resultSet.iterateNext())) {
        msg += "\nid : " + node.getAttribute("id");
        msg += "\nname :" + getNodeValue(node, "name");
        msg += "\nprice :" + getNodeValue(node, "price");
        msg += "\n-------------------------";
//        node = resultSet.iterateNext();
    }

    xmlOutput.value = msg;
  }

  function locationFilterExistName() {
    var resultSet = xmlDoc.evaluate(".//product[name]", xmlDoc.documentElement, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
    //출력용 textarea 이다.
    var xmlOutput = document.getElementById("xmlOutput");    
    var msg = "";
    
    for (var i=0;i<resultSet.snapshotLength;i++) {
        node = resultSet.snapshotItem (i);
        msg += "\nid : " + node.getAttribute("id");
        msg += "\nname :" + getNodeValue(node, "name");
        msg += "\nprice :" + getNodeValue(node, "price");
        msg += "\n-------------------------";
    }
    xmlOutput.value = msg;
  }

  window.onload = function() {
    loadXML();
  }

  </script>
</head>
<body>
<h3>XPath를 이용한 노드 찾기</h3>
<hr>
XML 문서 내용 <br/>
<textarea id='xmlContents' name='xmlContents' readonly="readonly" rows="17" cols="80" wrap="off"></textarea><br/>
결과 화면 <br/>
<textarea id='xmlOutput' name='xmlOutput' readonly="readonly" rows="8" cols="80" wrap="off"></textarea><br/>
<input type="button" value="product[0]" onclick="locationFilter1()">
<input type="button" value="product[last()]" onclick="locationFilterLast()">
<input type="button" value="product[@id='1']" onclick="locationFilterAttribute1()">
<input type="button" value="product[@id]" onclick="locationFilterExistAttribute()">
<input type="button" value="product[name]" onclick="locationFilterExistName()">
</body>
</html>