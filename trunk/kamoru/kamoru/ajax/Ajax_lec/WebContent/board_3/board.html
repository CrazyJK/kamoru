<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
<script type="text/javascript" src="ajax.js"></script>
<script type="text/javascript">
var key="";
var listProcess = false;

window.onload=function() {

	window.setTimeout("jsReload()", 1000);
    //게시물 목록을 얻기 위해 진행을 설정한다.
    //jsReload 실행을 하지 못하게 설정한다.
    listProcess = true;
	new ajax.xhr.Request("list2.jsp", null, resultList); 
}

function jsReload() {
    if (true == listProcess) return;
    
	new ajax.xhr.Request("isBoardChangeList.jsp", {key : key}, resultIsBoardChangeList); 
    window.setTimeout("jsReload()", 1000);
}

function resultIsBoardChangeList(req) {
	if (req.readystate == 4 && req.status == 200) {
        var result = eval(req.responseText)[0];
        debugTrace("result.isExist = " + result.isExist);
        if (false == result.isExist) {
            listProcess = true;
            new ajax.xhr.Request("list2.jsp", null, resultList);
        } 
    }
}

function jsDelete(board_id) {
	new ajax.xhr.Request("delete.jsp", {board_id : board_id}, resultList); 
}

function debugTrace(msg) {
        var debug = document.getElementById("debug");
        
        debug.innerHTML += "<br>" + msg;
}

function resultList(req) {
	if (req.readystate == 4 && req.status == 200) {
		var result = eval(req.responseText);
		var html = "";
		var list = document.getElementById("list"); 	
	
		html +="<table border='1'>";
		html +="<tr>";
		html +="<td>번호</td>";
		html +="<td>작성자</td>";
		html +="<td>제목</td>";
		html +="<td>작성일</td>";
		html +="<td>참조수</td>";
		html +="<td>삭제</td>";
		html +="</tr>";

        key = "";
		for (var i=0;i<result.length;i++) {
            
            key += result[i].board_id + "_";
            
			html += "<tr>";
			html += "<td>"+result[i].board_id+"</td>";
			html += "<td>"+result[i].writer+"</td>";
			html += "<td>"+result[i].title+"</td>";
			html += "<td>"+result[i].makedate+"</td>";
			html += "<td>"+result[i].ref_cnt+"</td>";
			html += "<td><span onclick='jsDelete("+result[i].board_id+")'>삭제</span></td>";
			html += "</tr>";
		}
		html += "</table>";
		
		list.innerHTML = html;
		
        //1초후 다시 서버로 부터 목록자료을 확인한다. 
        listProcess = false;
        window.setTimeout("jsReload()", 1000);
	}
}

</script>

</head>
<body>

<div id="list">
</div>

<div id="debug">
</div>

</body>
</html>